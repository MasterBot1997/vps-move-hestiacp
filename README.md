# Требование к серипту переноса.

#### Этапы выполнения скрипта: 
1. Проверяется наличие пользователя на которого выполняем перенос сайта, если пользователя нет, создаем его, по умолчанию в парсер передвется **user**
2. Если пользователя раньше не было, то ему просто добавляется новый сайт, если пользователь на месте, проверка есть ли сайт на переносимом домене
3. Дропаются файлы по стандартному пути, если передан параметр `--del-old-file`
4. Создается БД с названием обрезанным до 12 символов
5. функция rsync для переноса файлов
6. РЕдактирование прав на стандартные 644 и 755, в том числе седаются все файлы в которых заменится вохождение старых путей.
7. Проверяются доступы к БД через чек cms, определяются конфиги и по полученным досупам дампим БД
8. После экспорта дампа импортикуем ее в БД с имененм из шага 2
9. седаем пути в конфиг файле проверенным ранее через чек cms
10. Если передан параметр с версией php, то соответственно заменяем его для домена.


#### Функции основные:
- `create_user` - Создание пользователя
- `create_database` - создание и подключение БД к сайту
- `fix_permission` - корректировка прав доступа пользователя на дефолтные 755 и 644
- `sed_docroot` - функция седа старых путей
- `create_pas` - функция генерации паролей, вспомогательная функция
- `sync_file` - rsync файлов
- `sync_dump` - rsync dump
- `sed_db_access` - седаем старые доступы

#### Функции чеков:
- `check_user`- Проверка пользователя
- `check_cms` - функция определения популярных cms - создать отдельный скрипт, выполняется после синка файлов
- `create_user` - Создание пользователя
- `check_database` - проверка есть ли БД уже для сайта и существует ли она

---

#### Ключи передаваемые скрипту:

##### Обязательные:
- `-u user`
- `-h host`
- `-d docroot`
##### Опциональные:
- `--fix-permission`
- `--php-version`
- `--delete-old-file`
- `--php-mod`
- `--log-file`

---

#### Описание функций:


Функция синка файлов `syn_file` будет использовать rsync. Из требований:
- Отключить проверку хэша хоста
- Должен хавать обязательные параметры `-docroot`, `-user`, `-host`
- Опциональный параметр `-pas`, если лень прокидывать ключ, что просто передадим его в rsync
> Нужно будет учесть что `-pas` пароль без ключа стоит прокидывать если уверен что там на сервере и перепроверять ничего не надо

---

#### Последовательность переноса:

1. Проверяется `user` на которого будет добавлен домен:
    1.1. По умолчанию пользователь `user` проверяется его наличие
    1.2. Если пользователь есть, шаг `2`
    1.3. Если пользователя нет, он создается по паттерну `Usage: v-add-user USER PASSWORD EMAIL [PACKAGE] [NAME]` (В качествет почты берется `EMAIL` пользователя `admin`, паттерн `v-list-user admin | grep EMAIL | awk '{print $2}'`)

2. Домен на который переносится сайт(проверка домена):
    1.1. Если есть некст шаг.
    1.2. Если нет домена добавляем по паттерну `Usage: v-add-web-domain USER DOMAIN [IP] [RESTART] [ALIASES] [PROXY_EXTENSIONS]`.

3. rsync файлов
4. sed файлов